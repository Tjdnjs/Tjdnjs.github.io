---
layout : single
title : "[Node.js] 생활코딩 / 섹션 4. APP"
categories: nodejs
tag: [nodejs]
sidebar:
    nav: "docs"
---

# 목차

- [x] [글 생성 UI 만들기](#글-생성-ui-만들기)
- [x] [POST 방식으로 전송된 데이터 받기 & 파일 생성과 리다이렉션](#post-방식으로-전송된-데이터-받기--파일-생성과-리다이랙션)
- [x] [수정 링크 생성 및 수정 정보 전송](#수정-링크-생성-및-수정-정보-전송)
- [x] [파일명 변경 및 내용 저장](#파일명-변경-및-내용-저장)
- [x] [글 삭제 기능 완성](#글-삭제-기능-완성)

## 글 생성 UI 만들기

```javascript
else if(pathname ==='/create'){
    fs.readdir('./data', function(error, filelist){
        var title = 'Web - create'; // 제목 지정

        // 목차 리스트 생성 -> list 변수에 저장
        var list = '<ul>';
        var i = 0;
        while(i<filelist.length){
            list += `<li><a href="/?id=${filelist[i]}">${filelist[i]}</a></li>`;
            i += 1
        }
        list = list+'</ul>'

        // 제목, 내용 제출 가능한 폼
        // 제출 시 /process_create 로 이동
        var template = templateHTML(title, list, `
        <form action = "http://localhost:3000/create_process" method="post"> 
            <p><input type="text" name="title" placeholder="title"></p>
            <p><textarea name="description" placeholder="description"></textarea></p>
            <p><input type = "submit"></p>
        </form>
        `);
        response.writeHead(200);
        response.end(template);
    });
}
```

<img src="/images/node/7.png">

## POST 방식으로 전송된 데이터 받기 + 파일 생성과 리다이랙션

이 때 만들어둔 칸에 작성한 데이터를 받아오려면 아래 코드가 필요하다.

```javascript
else if(pathname === '/create_process'){ // submit 시 이동되는 주소
    var body = '';
    request.on('data', function(data){
        body += data;
    }); // 받아온 데이터를 body에 저장

    request.on('end', function(){
        var post = qs.parse(body); // body 의 내용 파싱하여 저장
        var title = post.title;
        var description = post.description;
        // data/title의 주소에 description을 내용으로 하는 파일 생성
        // 302 : redirection
        fs.writeFile(`data/${title}`, description,'utf8', function(err){ 
            response.writeHead(302, {Location: `/?id=${title}`});
            response.end();
        });
    });
}
```

### 글 작성

<img src="/images/node/9.png">

### 해당 글의 페이지로 redirect

<img src="/images/node/8.png">

### 생성된 파일

<img src="/images/node/10.png">

## 수정 링크 생성 및 수정 정보 전송

```javascript
// HTML을 수정하는 경우 링크 = /update?id=HTML
<a href="/update?id=${queryData.id}">update</a>
```

## 파일명 변경 및 내용 저장

```javascript
else if(pathname ==='/update'){
        fs.readdir('./data', function(error, filelist){
            fs.readFile(`data/${queryData.id}`, 'utf-8', function(err, description){
                var title = queryData.id;
                var list = '<ul>';
                var i = 0;
                while(i<filelist.length){
                    list += `<li><a href="/?id=${filelist[i]}">${filelist[i]}</a></li>`;
                    i += 1
                }
                list = list+'</ul>'

                // 기존 폼과 같으나, 원래 글의 내용을 표시하기 위해 value 사용

                var template = templateHTML(title, list, `
                <form action = "/update_process" method="post">
                    <input type = "hidden" name="id" value="${title}">
                    <p><input type="text" name="title" placeholder="title" value="${title}"></p>
                    <p><textarea name="description" placeholder="description" value="${description}"></textarea></p>
                    <p><input type = "submit"></p>
                </form>
                `);
                response.writeHead(200);
                response.end(template);
            });

        });
    }else if(pathname === '/update_process'){
        var body = '';
        request.on('data', function(data){
            body += data;
        });
        request.on('end', function(){
            var post = qs.parse(body);
            var id = post.id // 어떤 글이 수정 중인 지 알기 위해 기존 제목을 id로 받아옴
            var title = post.title;
            var description = post.description;
            fs.rename(`data/${id}`, `data/${title}`, function(error){
                fs.writeFile(`data/${title}`, description,'utf8', function(err){
                    response.writeHead(302, {Location: `/?id=${title}`});
                    response.end();
                });
            });
        });
    }
```

## 글 삭제 기능 완성

```javascript
// link 만으로 접속하여 삭제하는 일을 방지해야하기에, form과 post 메소드 사용
<form action="delete_process" method="post">
 <input type="hidden" name="id" value="${queryData.id}">
 <input type="submit" value="delete">
</form>
```

```javascript
else if(pathname === '/delete_process'){
    var body = '';
    request.on('data', function(data){
        body += data;
    });
    request.on('end', function(){
        var post = qs.parse(body);
        var id = post.id
        fs.unlink(`data/${id}`, function(error){ // data/${id} 삭제
            response.writeHead(302, {Location: `/`});
            response.end();
        })
    });
}
```